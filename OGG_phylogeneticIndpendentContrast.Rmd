---
title: "IndependentContrasts"
author: "Becca"
date: "May 16, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This R Markdown document is meant to develop independent contrast approach to analyzing the interspecific microarray data through embryogenesis -- to investigate whether an hourglass in gene expression similarity is present. Rank expression of each OGG by stage cluster will be used for the contrast. 
NOTES: species OGG expression mean by cluster comes from:
\All_projects\Phylotypic Stage\R\PhylotypicStage\MeanByCluster_OGG.Rmd


```{r, establishing datasets for pairwise comparisons}
#generate species by cluster RANKs for all OGGs
# "-" on the matrix gives descending order, highest rank lowest expression
MusOGGRank_clust5<-data.frame(t(apply(-MusMeanBYclust5, 1, rank))) 
GalOGGRank_clust5<-data.frame(t(apply(-GalMeanBYclust5, 1, rank))) 
XlaevOGGRank_clust5<-data.frame(t(apply(-XlaevMeanBYclust5, 1, rank))) 
XtropOGGRank_clust5<-data.frame(t(apply(-XtropMeanBYclust5, 1, rank))) 
DanOGGRank_clust5<-data.frame(t(apply(-DanMeanBYclust5, 1, rank))) 

#For each node look at the difference in OGG rank correct by summed branch lengths:
#abs(RANKsp1-RANKsp2)/(branch length 1 + branch length 2)
#branch length are median time estimates from time tree. 
AmnioteOGGRank_contrast_clust5<-(abs(MusOGGRank_clust5 - 
                          GalOGGRank_clust5))/sqrt(320+320)
FrogOGGRank_contrast_clust5<-(abs(XlaevOGGRank_clust5 - 
                       XtropOGGRank_clust5))/sqrt(52+52)

AnamnioteOGGRank_contrast_clust5<-(abs((MusOGGRank_clust5/2 + 
                                GalOGGRank_clust5/2) - 
                              (XlaevOGGRank_clust5/2 + 
                                 XtropOGGRank_clust5/2))/
                                sqrt(35+301))

VertebrateOGGRank_contrast_clust5<-(abs((MusOGGRank_clust5/4 + 
                                GalOGGRank_clust5/4 + 
                                XlaevOGGRank_clust5/4 + 
                                 XtropOGGRank_clust5/4) -
                                 DanOGGRank_clust5)/
                                  sqrt(79+432))
```
Cluster correlations of the Contrast dataframes

```{r}compute all pairwise correlaton
```{r}
PWstageCor_Pearson<-function(x,y) {
  x<-t(x)
  y<-t(y)
  z<-cor(x,y,use="pairwise.complete.obs", method="pearson")
  return(z)
}


PhyContrastClustCor5<-rbind.data.frame(diag(PWstageCor_Pearson(AmnioteOGGRank_contrast_clust5,
                                                       FrogOGGRank_contrast_clust5)),
                                       diag(PWstageCor_Pearson(AmnioteOGGRank_contrast_clust5, 
                                                       AnamnioteOGGRank_contrast_clust5)),
                                       diag(PWstageCor_Pearson(AmnioteOGGRank_contrast_clust5,
                                                       VertebrateOGGRank_contrast_clust5)),
                                       diag(PWstageCor_Pearson(FrogOGGRank_contrast_clust5,
                                                       AnamnioteOGGRank_contrast_clust5)),
                                       diag(PWstageCor_Pearson(FrogOGGRank_contrast_clust5,
                                                       VertebrateOGGRank_contrast_clust5)),
                                       diag(PWstageCor_Pearson(AnamnioteOGGRank_contrast_clust5,
                                                       VertebrateOGGRank_contrast_clust5)))
colnames(PhyContrastClustCor5)<-c("cluster1", 
                                  "cluster2", 
                                  "cluster3", 
                                  "cluster4", 
                                  "cluster5")
rownames(PhyContrastClustCor5)<-c("Amniote_Frog", 
                                  "Amniote_Anamniote", 
                                  "Amniote_Vertebrate", 
                                  "Frog_Anamniote", 
                                  "Frog_Vertebrate",
                                  "Anamniote_Vertebrate")

##################using rank correlation
PhyContrastClustCor5_Rank<-rbind.data.frame(diag(PWstageCor(AmnioteOGGRank_contrast_clust5,
                                                       FrogOGGRank_contrast_clust5)),
                                       diag(PWstageCor(AmnioteOGGRank_contrast_clust5, 
                                                       AnamnioteOGGRank_contrast_clust5)),
                                       diag(PWstageCor(AmnioteOGGRank_contrast_clust5,
                                                       VertebrateOGGRank_contrast_clust5)),
                                       diag(PWstageCor(FrogOGGRank_contrast_clust5,
                                                       AnamnioteOGGRank_contrast_clust5)),
                                       diag(PWstageCor(FrogOGGRank_contrast_clust5,
                                                       VertebrateOGGRank_contrast_clust5)),
                                       diag(PWstageCor(AnamnioteOGGRank_contrast_clust5,
                                                       VertebrateOGGRank_contrast_clust5)))
colnames(PhyContrastClustCor5_Rank)<-c("cluster1", 
                                  "cluster2", 
                                  "cluster3", 
                                  "cluster4", 
                                  "cluster5")
rownames(PhyContrastClustCor5_Rank)<-c("Amniote_Frog", 
                                  "Amniote_Anamniote", 
                                  "Amniote_Vertebrate", 
                                  "Frog_Anamniote", 
                                  "Frog_Vertebrate",
                                  "Anamniote_Vertebrate")
```
plot box_RankCor_clust is from MeanByCluster_OGG.Rmd
```{r, plots}
library("reshape2")
library("ggplot2")
#pdf("PhyloContrast_hourglass.pdf", useDingbats = FALSE)
box_RankCor_clust(PhyContrastClustCor5)
box_RankCor_clust(PhyContrastClustCor5_Rank)
#dev.off()
```
perform stats on the contrasted data
```{r, stats}
x=(PhyContrastClustCor5)
y=nrow(x)
k1<-data.frame(x$cluster1)
colnames(k1)<-"k"
k2<-data.frame(x$cluster2)
colnames(k2)<-"k"
k3<-data.frame(x$cluster3)
colnames(k3)<-"k"
k4<-data.frame(x$cluster4)
colnames(k4)<-"k"
k5<-data.frame(x$cluster5)
colnames(k5)<-"k"
k=rbind.data.frame(k1,
                   k2,
                   k3,
                   k4,
                   k5)
time<-data.frame(rep(c("k1",
                       "k2",
                       "k3",
                       "k4",
                       "k5"), 
                     c(y,
                       y,
                       y,
                       y,
                       y)))
k5all=cbind.data.frame(time,
                       k)
colnames(k5all)<-c("time",
                   "k")

summary(aov(k~time, 
            data=k5all))
TukeyHSD(aov(k~time, 
             data=k5all))


##################
x=(PhyContrastClustCor5_Rank)
y=nrow(x)
k1<-data.frame(x$cluster1)
colnames(k1)<-"k"
k2<-data.frame(x$cluster2)
colnames(k2)<-"k"
k3<-data.frame(x$cluster3)
colnames(k3)<-"k"
k4<-data.frame(x$cluster4)
colnames(k4)<-"k"
k5<-data.frame(x$cluster5)
colnames(k5)<-"k"
k=rbind.data.frame(k1,
                   k2,
                   k3,
                   k4,
                   k5)
time<-data.frame(rep(c("k1",
                       "k2",
                       "k3",
                       "k4",
                       "k5"), 
                     c(y,
                       y,
                       y,
                       y,
                       y)))
k5all=cbind.data.frame(time,
                       k)
colnames(k5all)<-c("time",
                   "k")

summary(aov(k~time, 
            data=k5all))
TukeyHSD(aov(k~time, 
             data=k5all))
```